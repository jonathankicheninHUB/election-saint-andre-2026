import React, { useState } from 'react';
import { BarChart, Bar, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar } from 'recharts';
import { TrendingUp, TrendingDown, Users, Award, AlertCircle, Target, Clock } from 'lucide-react';

const COLORS = ['#06b6d4', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981', '#ef4444', '#3b82f6'];
const BACKGROUND_COLOR = '#0f172a';

// --- DONN√âES √âLECTORALES ---
const electionData = {
  2008: { tour1: [{ candidat: 'Eric Fruteau', parti: 'DVG', voix: 9351, pourcentage: 48.39 }, { candidat: 'Jean-Paul Virapoull√©', parti: 'DVD', voix: 7788, pourcentage: 40.30 }, { candidat: 'Emmanuel Seriacaroupin', parti: 'DVG', voix: 2187, pourcentage: 11.32 }], tour2: [{ candidat: 'Eric Fruteau', parti: 'DVG', voix: 13150, pourcentage: 58.30, elu: true, sieges: 34 }, { candidat: 'Jean-Paul Virapoull√©', parti: 'DVD', voix: 9404, pourcentage: 41.70, sieges: 9 }], participation: { tour1: 71.07, tour2: 80.45 }, votants: { tour1: 20139, tour2: 23069 } },
  2014: { tour1: [{ candidat: 'Jean Paul Virapoull√©', parti: 'DVD', voix: 11365, pourcentage: 49.96 }, { candidat: 'Claudy Fruteau', parti: 'DVG', voix: 5024, pourcentage: 22.08 }, { candidat: 'Jo√© Bedier', parti: 'DVG', voix: 2753, pourcentage: 12.10 }, { candidat: 'Serge Camatchy', parti: 'DVG', voix: 2432, pourcentage: 10.69 }, { candidat: 'Jean-Fran√ßois Ramassamy', parti: 'DVD', voix: 845, pourcentage: 3.71 }], tour2: [{ candidat: 'Jean Paul Virapoull√©', parti: 'DVD', voix: 15348, pourcentage: 62.57, elu: true, sieges: 37 }, { candidat: 'Claudy Fruteau', parti: 'DVG', voix: 5604, pourcentage: 22.84, sieges: 5 }, { candidat: 'Jo√© Bedier', parti: 'DVG', voix: 3575, pourcentage: 14.57, sieges: 3 }], participation: { tour1: 68.08, tour2: 73.08 }, votants: { tour1: 23688, tour2: 25428 } },
  2020: { tour1: [{ candidat: 'Jean-Marie Virapoull√©', parti: 'DVD', voix: 5722, pourcentage: 31.47 }, { candidat: 'Jo√© Bedier', parti: 'DVG', voix: 4524, pourcentage: 24.88 }, { candidat: 'Eric Fruteau', parti: 'DVG', voix: 3107, pourcentage: 17.09 }, { candidat: 'Jean Fran√ßois Ramassamy', parti: 'DVD', voix: 1058, pourcentage: 5.81 }, { candidat: 'Serge Antoine Camatchy', parti: 'DVG', voix: 1001, pourcentage: 5.50 }, { candidat: 'Sylvie Moutoucomorapoule', parti: 'DVG', voix: 1000, pourcentage: 5.50 }], tour2: [{ candidat: 'Jo√© Bedier', parti: 'DVG', voix: 10703, pourcentage: 52.16, elu: true, sieges: 34 }, { candidat: 'Jean-Marie Virapoull√©', parti: 'DVD', voix: 9813, pourcentage: 47.83, sieges: 11 }], participation: { tour1: 48.06, tour2: 54.84 }, votants: { tour1: 18867, tour2: 21656 } }
};

const candidats2026 = [
  { nom: 'Jo√© Bedier (Maire)', parti: 'DVG / Majorit√©', statut: 'Maire sortant', projectionT1: 28, projectionT2: 54, force: 85, notoriete: 95, ancrage: 80, dynamique: 70, couleur: '#06b6d4', analyse: 'Maire sortant avec un bilan √† d√©fendre. B√©n√©ficie de la prime au sortant mais doit mobiliser face √† une opposition fragment√©e.' },
  { nom: 'J.M. Virapoull√© (Opposition)', parti: 'DVD / Alliance', statut: 'Opposant principal', projectionT1: 26, projectionT2: 46, force: 75, notoriete: 90, ancrage: 85, dynamique: 60, couleur: '#8b5cf6', analyse: 'Chef de file de la famille historique. Son alliance conditionne sa qualification et sa capacit√© √† rassembler les d√©√ßus de la majorit√©.' },
  { nom: 'L. Virapoull√© (RN)', parti: 'RN / Extr√™me Droite', statut: 'Candidat √©mergent', projectionT1: 15, projectionT2: null, force: 50, notoriete: 65, ancrage: 40, dynamique: 80, couleur: '#ef4444', analyse: 'Nouveau p√¥le d\'attraction autour du Rassemblement National. Son score au T1 est cl√© pour les alliances au T2.' },
  { nom: 'Eric Fruteau', parti: 'DVG / Ancien Maire', statut: 'Candidat dissident', projectionT1: 10, projectionT2: null, force: 40, notoriete: 75, ancrage: 60, dynamique: 30, couleur: '#f59e0b', analyse: 'Ancien maire en d√©clin. Son maintien fragmente le vote DVG et complique la t√¢che de Jo√© Bedier.' },
  { nom: 'Soci√©t√© Civile / √âcologie', parti: 'Divers', statut: 'Liste de rupture', projectionT1: 11, projectionT2: null, force: 35, notoriete: 35, ancrage: 30, dynamique: 70, couleur: '#10b981', analyse: 'Capte le vote protestataire et la volatilit√© jeune. Leur score total (11%) est un facteur X majeur.' },
  { nom: 'Autres Oppositions', parti: 'Divers', statut: 'Petits candidats', projectionT1: 10, projectionT2: null, force: 20, notoriete: 30, ancrage: 25, dynamique: 40, couleur: '#ec4899', analyse: 'Listes non qualifiantes. Leur report de voix est critique entre les deux blocs principaux.' }
];

const evolutionPolitique = [{ annee: '2008', DVG: 58.30, DVD: 41.70 }, { annee: '2014', DVG: 37.41, DVD: 62.57 }, { annee: '2020', DVG: 52.16, DVD: 47.83 }, { annee: '2026*', DVG: 54, DVD: 46 }];
const evolutionParticipation = [{ annee: '2008', tour1: 71.07, tour2: 80.45 }, { annee: '2014', tour1: 68.08, tour2: 73.08 }, { annee: '2020', tour1: 48.06, tour2: 54.84 }, { annee: '2026*', tour1: 52, tour2: 58 }];
const acteursHistorique = [
  { nom: 'Famille Virapoull√©', periodes: [{ annee: 2008, resultat: 41.70, statut: 'D√©faite' }, { annee: 2014, resultat: 62.57, statut: 'Victoire' }, { annee: 2020, resultat: 47.83, statut: 'D√©faite' }], tendance: 'decline', analyse: 'Apr√®s une victoire nette en 2014, perte du pouvoir en 2020. En 2026, l\'alliance est la cl√© pour revenir.' },
  { nom: 'Jo√© Bedier (Maire Sortant)', periodes: [{ annee: 2014, resultat: 14.57, statut: 'Troisi√®me' }, { annee: 2020, resultat: 52.16, statut: 'Victoire' }], tendance: 'rise', analyse: 'Ascension remarquable en 2020. Doit consolider sa majorit√© et g√©rer la fragmentation √† gauche.' },
  { nom: 'Base √âlectorale D√©mographique', periodes: [{ annee: 2008, resultat: 75, statut: 'Forte' }, { annee: 2014, resultat: 65, statut: 'Moyenne' }, { annee: 2020, resultat: 55, statut: 'D√©clin' }, { annee: 2026, resultat: 45, statut: 'Faible' }], tendance: 'decline', analyse: '√ârosion de la base historique (mortalit√©), for√ßant les candidats √† capter le vote volatil des jeunes et des nouveaux habitants.' }
];
const blocsPolitiques2026 = [
    { nom: 'Bloc DVG (Bedier)', pourcentage: 28, couleur: '#06b6d4' },
    { nom: 'Bloc DVD/Alliance (Virapoull√©)', pourcentage: 26, couleur: '#8b5cf6' },
    { nom: 'Bloc RN / Anti-Syst√®me', pourcentage: 15, couleur: '#ef4444' },
    { nom: 'Fragmentation DVG (Fruteau)', pourcentage: 10, couleur: '#f59e0b' },
    { nom: 'Nouveaux/√âcolo', pourcentage: 11, couleur: '#10b981' },
    { nom: 'Autres', pourcentage: 10, couleur: '#ec4899' },
];
// --- FIN DES DONN√âES √âLECTORALES ---

// Composant Tooltip Personnalis√©
const CustomTooltip = ({ active, payload, label }) => {
  if (active && payload && payload.length) {
    const data = payload[0].payload;
    return (
      <div className="p-3 bg-slate-900 border border-white/30 rounded-lg shadow-xl text-white">
        <p className="font-bold text-lg mb-1">{label}</p>
        <p className="text-sm">{data.candidat || data.nom} ({data.parti || data.statut})</p>
        <p className="text-xl font-extrabold" style={{ color: payload[0].color }}>{payload[0].value.toFixed(2)}%</p>
        <p className="text-xs text-gray-400 mt-1">Voix : {data.voix || 'N/A'}</p>
      </div>
    );
  }
  return null;
};

// Composant principal
const App = () => {
  const [selectedYear, setSelectedYear] = useState('2020');
  const [viewMode, setViewMode] = useState('projection2026');

  const renderOverview = () => (
    <div className="space-y-6 animate-fadeIn">
      <div className="bg-gradient-to-br from-purple-600 to-pink-600 text-white p-6 rounded-2xl shadow-xl">
        <h2 className="text-3xl font-extrabold">üìä Synth√®se Historique</h2>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card icon={Award} title="Maire actuel (2020)" value="Jo√© Bedier" subtitle="DVG - 52,16%" color="cyan" />
        <Card icon={TrendingDown} title="Participation 2020 (T2)" value="54,84%" subtitle="Baisse de 18 points vs 2014 ‚ö†Ô∏è" color="pink" />
        <Card icon={Users} title="Volatilit√© Jeunesse" value="Facteur X" subtitle="Cl√© pour 2026" color="indigo" />
      </div>

      <ChartCard title="√âvolution de la participation √©lectorale" borderColor="yellow">
        <LineChart data={evolutionParticipation}>
          <CartesianGrid strokeDasharray="3 3" stroke="#ffffff30" />
          <XAxis dataKey="annee" stroke="#fff" />
          <YAxis domain={[0, 100]} stroke="#fff" />
          <Tooltip contentStyle={{backgroundColor: BACKGROUND_COLOR, border: '1px solid #ffffff30', borderRadius: '8px'}} />
          <Legend />
          <Line type="monotone" dataKey="tour1" stroke="#f59e0b" name="Tour 1 (%)" strokeWidth={2} dot={{r: 4}} />
          <Line type="monotone" dataKey="tour2" stroke="#06b6d4" name="Tour 2 (%)" strokeWidth={2} dot={{r: 4}} />
        </LineChart>
      </ChartCard>

      <ChartCard title="Alternance gauche-droite (R√©sultat T2)" borderColor="pink">
        <BarChart data={evolutionPolitique}>
          <CartesianGrid strokeDasharray="3 3" stroke="#ffffff30" />
          <XAxis dataKey="annee" stroke="#fff" />
          <YAxis domain={[0, 100]} stroke="#fff" />
          <Tooltip contentStyle={{backgroundColor: BACKGROUND_COLOR, border: '1px solid #ffffff30', borderRadius: '8px'}} />
          <Legend />
          <Bar dataKey="DVG" fill="#06b6d4" name="Divers Gauche (%)" radius={[5, 5, 0, 0]} />
          <Bar dataKey="DVD" fill="#8b5cf6" name="Divers Droite / Alli√© (%)" radius={[5, 5, 0, 0]} />
        </BarChart>
      </ChartCard>
    </div>
  );

  const renderActeurs = () => (
    <div className="space-y-6 animate-fadeIn">
      <div className="bg-gradient-to-r from-teal-600 to-cyan-700 text-white p-6 rounded-2xl shadow-xl">
        <h2 className="text-3xl font-extrabold">üë§ Acteurs et D√©mographie</h2>
      </div>
        
      {acteursHistorique.map((acteur, idx) => (
        <div key={idx} className={`bg-slate-800 p-6 rounded-xl shadow-xl border-l-4 ${acteur.tendance === 'rise' ? 'border-emerald-500' : 'border-rose-500'}`}>
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-xl font-bold text-white">{acteur.nom}</h3>
            <span className={`px-3 py-1 text-xs rounded-full font-bold ${acteur.tendance === 'rise' ? 'bg-green-600' : 'bg-red-600'}`}>
              {acteur.tendance === 'rise' ? 'üìà En hausse' : 'üìâ En d√©clin'}
            </span>
          </div>
          <ResponsiveContainer width="100%" height={150}>
            <LineChart data={acteur.periodes}>
              <CartesianGrid strokeDasharray="3 3" stroke="#ffffff20" />
              <XAxis dataKey="annee" stroke="#fff" />
              <YAxis domain={[0, 70]} stroke="#fff" />
              <Tooltip contentStyle={{backgroundColor: BACKGROUND_COLOR, border: '1px solid #ffffff30', borderRadius: '8px'}} />
              <Line type="monotone" dataKey="resultat" stroke={acteur.tendance === 'rise' ? '#10b981' : '#ec4899'} name="R√©sultat / Force (%)" strokeWidth={2} dot={{r: 4}} />
            </LineChart>
          </ResponsiveContainer>
          <p className="text-sm mt-4 text-gray-300"><strong>Analyse :</strong> {acteur.analyse}</p>
        </div>
      ))}
    </div>
  );

  const renderProjection2026 = () => (
    <div className="space-y-6 animate-fadeIn">
      <div className="bg-gradient-to-r from-yellow-500 to-red-600 text-white p-6 rounded-2xl shadow-xl">
        <h2 className="text-3xl font-extrabold">üîÆ Projections Municipales 2026</h2>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
        {/* Candidats et Radar */}
        <div className="lg:col-span-1 space-y-4">
          <h3 className="text-xl font-bold text-white">Forces en Pr√©sence (T1)</h3>
          {candidats2026.map((candidat, idx) => (
            <div key={idx} className="bg-slate-800 p-4 rounded-xl shadow-xl border-l-4" style={{borderColor: candidat.couleur}}>
              <div className="flex items-center justify-between mb-2">
                <div>
                  <h4 className="text-lg font-bold text-white">{candidat.nom}</h4>
                  <p className="text-xs text-gray-400">{candidat.parti}</p>
                </div>
                <div className="text-3xl font-extrabold" style={{color: candidat.couleur}}>{candidat.projectionT1}%</div>
              </div>

              {/* Radar Chart */}
              <ResponsiveContainer width="100%" height={120}>
                <RadarChart data={[
                  { metric: 'Force', value: candidat.force, fullMark: 100 },
                  { metric: 'Notori√©t√©', value: candidat.notoriete, fullMark: 100 },
                  { metric: 'Ancrage', value: candidat.ancrage, fullMark: 100 },
                  { metric: 'Dynamique', value: candidat.dynamique, fullMark: 100 }
                ]}>
                  <PolarGrid stroke="#ffffff30" />
                  <PolarAngleAxis dataKey="metric" stroke="#fff" fontSize={10} />
                  <Radar dataKey="value" stroke={candidat.couleur} fill={candidat.couleur} fillOpacity={0.4} />
                </RadarChart>
              </ResponsiveContainer>
            </div>
          ))}
        </div>

        {/* Graphiques Projection */}
        <div className="lg:col-span-1 space-y-4">
          <ChartCard title="Barom√®tre T1 - Fragmentation" borderColor="indigo">
            <BarChart data={candidats2026.sort((a, b) => b.projectionT1 - a.projectionT1)}>
              <CartesianGrid strokeDasharray="3 3" stroke="#ffffff30" />
              <XAxis dataKey="nom" stroke="#fff" angle={-30} textAnchor="end" height={80} interval={0} fontSize={10} />
              <YAxis stroke="#fff" />
              <Tooltip contentStyle={{backgroundColor: BACKGROUND_COLOR, border: '1px solid #ffffff30', borderRadius: '8px'}} />
              <Bar dataKey="projectionT1" name="Projection T1 (%)" radius={[5, 5, 0, 0]}>
                {candidats2026.map((entry, index) => (<Cell key={`cell-${index}`} fill={entry.couleur} />))}
              </Bar>
            </BarChart>
          </ChartCard>

          <ChartCard title="R√©partition des Blocs Politiques (T1)" borderColor="cyan">
            <PieChart>
              <Pie data={blocsPolitiques2026} dataKey="pourcentage" nameKey="nom" cx="50%" cy="50%" innerRadius={50} outerRadius={100} label={({ nom, pourcentage }) => `${nom.split(' ')[0]} ${pourcentage}%`} labelLine={false}>
                {blocsPolitiques2026.map((entry, index) => (<Cell key={`cell-${index}`} fill={entry.couleur} />))}
              </Pie>
              <Tooltip contentStyle={{backgroundColor: BACKGROUND_COLOR, border: '1px solid #ffffff30', borderRadius: '8px'}} />
            </PieChart>
          </ChartCard>
          
          <div className="bg-emerald-700 p-4 rounded-xl shadow-xl">
            <h3 className="text-xl font-bold text-white mb-2 flex items-center gap-2"><Clock size={20} /> Cl√©s de la Victoire (T2)</h3>
            <ul className="list-disc pl-5 text-sm text-white space-y-1">
              <li><strong>Mobilisation :</strong> Le Bloc Bedier doit maximiser le report des voix DVG.</li>
              <li><strong>Facteur RN :</strong> L'alliance Virapoull√© doit g√©rer le report des voix DVD face au RN.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );

  const renderDetail = () => {
    const data = electionData[selectedYear];
    
    return (
      <div className="space-y-6 animate-fadeIn">
        <div className="bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-6 rounded-2xl shadow-xl">
            <h2 className="text-3xl font-extrabold">üîé R√©sultats D√©taill√©s - {selectedYear}</h2>
        </div>

        <div className="flex flex-wrap gap-3 mb-4">
          {['2008', '2014', '2020'].map(year => (
            <button key={year} onClick={() => setSelectedYear(year)} className={`px-4 py-2 rounded-lg font-bold text-sm ${selectedYear === year ? 'bg-pink-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`}>{year}</button>
          ))}
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <ChartCard title="Tour 1 - R√©partition des Votes" borderColor="blue">
            <PieChart>
              <Pie data={data.tour1} dataKey="pourcentage" nameKey="candidat" cx="50%" cy="50%" outerRadius={100} label={(entry) => `${entry.candidat.split(' ')[0]} ${entry.pourcentage}%`} labelLine={false}>
                {data.tour1.map((entry, index) => (<Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />))}
              </Pie>
              <Tooltip content={CustomTooltip} />
            </PieChart>
            <Legend wrapperStyle={{color: 'white', marginTop: '10px'}} />
          </ChartCard>

          <div className="bg-emerald-700 p-4 rounded-xl shadow-xl border-l-4 border-green-300">
            <h3 className="text-xl font-bold mb-3 text-white">üèÜ Tour 2 - √âlus et Si√®ges</h3>
            <div className="space-y-3">
              {data.tour2.map((entry, index) => (
                <div key={index} className={`p-3 rounded-lg border-l-4 ${entry.elu ? 'border-yellow-300 bg-green-900/50' : 'border-red-300 bg-slate-800/50'}`}>
                  <div className="flex justify-between items-center text-white">
                    <span className="font-bold">{entry.candidat} {entry.elu && ' (√âLU)'}</span>
                    <span className="text-xl font-extrabold">{entry.pourcentage}%</span>
                  </div>
                  <p className="text-xs text-gray-300">Si√®ges : <span className="font-bold">{entry.sieges}</span></p>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  };
  
  // Composants UI abstraits
  const Card = ({ icon: Icon, title, value, subtitle, color }) => (
    <div className={`bg-gradient-to-br from-${color}-600 to-${color}-700 p-4 rounded-xl shadow-xl`}>
      <div className="flex items-center gap-2 mb-2">
        <Icon className="text-white" size={24} />
        <h3 className="font-bold text-white text-sm">{title}</h3>
      </div>
      <p className="text-2xl font-bold text-white mb-1">{value}</p>
      <p className={`text-${color}-100 font-semibold text-xs`}>{subtitle}</p>
    </div>
  );

  const ChartCard = ({ title, children, borderColor }) => (
    <div className={`bg-slate-800 p-4 rounded-xl shadow-2xl border-t-4 border-${borderColor}-500`}>
      <h3 className="text-xl font-bold mb-4 text-white">{title}</h3>
      <ResponsiveContainer width="100%" height={250}>
        {children}
      </ResponsiveContainer>
    </div>
  );

  return (
    <div className="min-h-screen p-4 font-inter" style={{ backgroundColor: BACKGROUND_COLOR }}>
      <div className="max-w-7xl mx-auto">
        <header className="py-4 mb-6 border-b border-slate-700">
          <h1 className="text-3xl font-extrabold text-white text-center">
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500">Saint-Andr√© 2026</span>
          </h1>
        </header>

        <nav className="flex flex-wrap justify-center gap-3 mb-6">
          {[
            { id: 'projection2026', label: 'üîÆ 2026' },
            { id: 'overview', label: 'üìä Historique' },
            { id: 'acteurs', label: 'üë§ Acteurs' },
            { id: 'detail', label: 'üìà D√©tails' }
          ].map(item => (
            <button
              key={item.id}
              onClick={() => setViewMode(item.id)}
              className={`px-4 py-2 rounded-full font-bold text-sm ${
                viewMode === item.id ? 'bg-gradient-to-r from-cyan-500 to-purple-600 text-white' : 'bg-slate-700 text-slate-300'
              }`}
            >
              {item.label}
            </button>
          ))}
        </nav>

        <main>
          {viewMode === 'overview' && renderOverview()}
          {viewMode === 'acteurs' && renderActeurs()}
          {viewMode === 'projection2026' && renderProjection2026()}
          {viewMode === 'detail' && renderDetail()}
        </main>
      </div>
    </div>
  );
};

export default App;
